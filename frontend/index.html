<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pipeline Studio - Transform Documents into Intelligence</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.5); }
            50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.8); }
        }
        
        @keyframes slide-up {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .gradient-animated {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        .slide-up {
            animation: slide-up 0.5s ease-out;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .neon-text {
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.8),
                         0 0 20px rgba(168, 85, 247, 0.6),
                         0 0 30px rgba(168, 85, 247, 0.4);
        }
        
        .task-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .task-card:hover {
            transform: translateY(-5px) scale(1.02);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }
        
        .file-drop-zone {
            border: 2px dashed #cbd5e0;
            transition: all 0.3s ease;
        }
        
        .file-drop-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.02);
        }
        
        .blob-shape {
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            filter: blur(40px);
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // API Configuration
        const API_URL = 'http://localhost:8000';
        
        // Animated Background Component
        const AnimatedBackground = () => (
            <div className="fixed inset-0 -z-10 overflow-hidden">
                <div className="absolute top-0 -left-4 w-72 h-72 bg-purple-300 rounded-full blob-shape floating"></div>
                <div className="absolute top-0 right-0 w-96 h-96 bg-pink-300 rounded-full blob-shape floating" style={{animationDelay: '2s'}}></div>
                <div className="absolute bottom-0 left-1/2 w-80 h-80 bg-blue-300 rounded-full blob-shape floating" style={{animationDelay: '4s'}}></div>
            </div>
        );
        
        // File Upload Component
        const FileUpload = ({ onFileUpload }) => {
            const [dragOver, setDragOver] = useState(false);
            const [uploading, setUploading] = useState(false);
            const fileInputRef = useRef(null);
            
            const handleDrop = async (e) => {
                e.preventDefault();
                setDragOver(false);
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    await handleFile(files[0]);
                }
            };
            
            const handleFile = async (file) => {
                setUploading(true);
                
                const formData = new FormData();
                formData.append('file', file);
                
                try {
                    const response = await fetch(`${API_URL}/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    onFileUpload(data);
                } catch (error) {
                    console.error('Upload error:', error);
                    alert('Failed to upload file');
                } finally {
                    setUploading(false);
                }
            };
            
            return (
                <div
                    className={`file-drop-zone p-8 rounded-xl text-center ${dragOver ? 'dragover' : ''}`}
                    onDrop={handleDrop}
                    onDragOver={(e) => { e.preventDefault(); setDragOver(true); }}
                    onDragLeave={() => setDragOver(false)}
                    onClick={() => fileInputRef.current?.click()}
                >
                    <input
                        ref={fileInputRef}
                        type="file"
                        className="hidden"
                        accept=".pdf,.txt,.docx,.md,.html"
                        onChange={(e) => e.target.files[0] && handleFile(e.target.files[0])}
                    />
                    
                    {uploading ? (
                        <div className="space-y-4">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto"></div>
                            <p className="text-gray-600">Uploading...</p>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            <div className="text-6xl">📄</div>
                            <div>
                                <p className="text-lg font-semibold text-gray-700">Drop your document here</p>
                                <p className="text-sm text-gray-500 mt-1">or click to browse</p>
                            </div>
                            <p className="text-xs text-gray-400">Supports PDF, TXT, DOCX, MD, HTML (Max 10MB)</p>
                        </div>
                    )}
                </div>
            );
        };
        
        // Task Result Component
        const TaskResult = ({ task, output }) => {
    const [expanded, setExpanded] = useState(false);
    
    const renderOutput = () => {
        if (task.name === 'Summarization') {
            return (
                <div className="bg-gray-50 rounded-lg p-4 mt-3">
                    <p className="text-gray-700 leading-relaxed whitespace-pre-line">{output.summary}</p>
                </div>
            );
        } else if (task.name === 'Key Points Extraction') {
            return (
                <div className="mt-3 space-y-2">
                    {output.key_points?.map((point, i) => (
                        <div key={i} className="flex items-start space-x-2">
                            <span className="text-purple-500 mt-1">•</span>
                            <p className="text-gray-700">{point}</p>
                        </div>
                    ))}
                </div>
            );
        } else if (task.name === 'Methodology Extraction') {
            return (
                <div className="mt-3 space-y-2">
                    {output.methodology?.map((method, i) => (
                        <div key={i} className="flex items-start space-x-2">
                            <span className="text-blue-500 mt-1">🔬</span>
                            <p className="text-gray-700">{method}</p>
                        </div>
                    ))}
                </div>
            );
        } else if (task.name === 'Citation Extraction') {
            return (
                <div className="mt-3 bg-gray-50 rounded-lg p-4">
                    <div className="flex flex-wrap gap-2">
                        {output.citations?.map((cite, i) => (
                            <span key={i} className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
                                {cite}
                            </span>
                        ))}
                    </div>
                </div>
            );
        } else if (task.name === 'Action Items') {
            return (
                <div className="mt-3 space-y-2">
                    {output.action_items?.map((action, i) => (
                        <div key={i} className="flex items-start space-x-2">
                            <span className="text-green-500 mt-1">✓</span>
                            <p className="text-gray-700">{action}</p>
                        </div>
                    ))}
                </div>
            );
        } else if (task.name === 'Quiz Generation') {
            return (
                <div className="mt-3 space-y-4">
                    {output.quiz?.slice(0, expanded ? undefined : 2).map((q, i) => (
                        <div key={i} className="bg-gray-50 rounded-lg p-4">
                            <p className="font-semibold text-gray-800 mb-2">Q{i+1}: {q.question}</p>
                            <div className="space-y-1 ml-4">
                                {q.options.map((opt, j) => (
                                    <div key={j} className={`text-sm ${j === q.correct_answer ? 'text-green-600 font-semibold' : 'text-gray-600'}`}>
                                        {String.fromCharCode(65 + j)}. {opt}
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                    {output.quiz?.length > 2 && (
                        <button
                            onClick={() => setExpanded(!expanded)}
                            className="text-purple-600 hover:text-purple-700 text-sm font-medium"
                        >
                            {expanded ? 'Show less' : `Show ${output.quiz.length - 2} more questions`}
                        </button>
                    )}
                </div>
            );
        } else if (task.name === 'Presentation') {
            return (
                <div className="mt-3">
                    <a 
                        href={`${API_URL}${output.presentation?.download_url}`}
                        download
                        className="inline-block bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-lg font-medium hover:shadow-lg transform hover:scale-105 transition-all"
                    >
                        📥 Download PowerPoint ({(output.presentation?.size / 1024).toFixed(0)}KB)
                    </a>
                </div>
            );
        }
        
        return <p className="text-gray-600 mt-2">{task.output_preview}</p>;
    };
    
    return (
        <div className="bg-white rounded-xl shadow-lg p-6 task-card">
            <div className="flex items-center justify-between mb-3">
                <div className="flex items-center space-x-3">
                    <div className="w-10 h-10 bg-gradient-to-br from-green-400 to-green-600 rounded-lg flex items-center justify-center text-white font-bold">
                        ✓
                    </div>
                    <h3 className="font-semibold text-gray-800">{task.name}</h3>
                </div>
                <span className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium">
                    Completed
                </span>
            </div>
            {renderOutput()}
        </div>
    );
};
        
        // Main App Component
        const App = () => {
            const [prompt, setPrompt] = useState('');
            const [document, setDocument] = useState(null);
            const [pipeline, setPipeline] = useState(null);
            const [loading, setLoading] = useState(false);
            const [activeTab, setActiveTab] = useState('upload');
            
            const templates = [
                {
                    icon: '📚',
                    title: 'Study Assistant',
                    description: 'Perfect for students',
                    prompt: 'Summarize this document, extract key points, generate 10 quiz questions, and create a presentation',
                    gradient: 'from-blue-500 to-cyan-500'
                },
                {
                    icon: '💼',
                    title: 'Business Report',
                    description: 'Executive summary',
                    prompt: 'Create an executive summary, identify main insights, extract action items, and prepare slides',
                    gradient: 'from-purple-500 to-pink-500'
                },
                {
                    icon: '🔬',
                    title: 'Research Analysis',
                    description: 'Academic papers',
                    prompt: 'Summarize methodology, extract findings, list citations, create study questions',
                    gradient: 'from-green-500 to-teal-500'
                },
                {
                    icon: '📰',
                    title: 'Article Digest',
                    description: 'News & articles',
                    prompt: 'Summarize article, extract key facts, identify main arguments, create discussion points',
                    gradient: 'from-orange-500 to-red-500'
                }
            ];
            
            const executePipeline = async () => {
                if (!prompt.trim()) {
                    alert('Please enter a prompt');
                    return;
                }
                
                if (!document) {
                    alert('Please upload a document first');
                    return;
                }
                
                setLoading(true);
                setPipeline(null);
                
                try {
                    const response = await fetch(`${API_URL}/pipeline/execute`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            prompt: prompt,
                            document_id: document.document_id
                        })
                    });
                    
                    const data = await response.json();
                    setPipeline(data);
                    
                    // Animate task completion
                    data.tasks.forEach((task, index) => {
                        setTimeout(() => {
                            setPipeline(prev => ({
                                ...prev,
                                tasks: prev.tasks.map((t, i) => ({
                                    ...t,
                                    animated: i <= index
                                }))
                            }));
                        }, index * 500);
                    });
                    
                } catch (error) {
                    console.error('Pipeline error:', error);
                    alert('Failed to execute pipeline');
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 relative">
                    <AnimatedBackground />
                    
                    {/* Header */}
                    <header className="gradient-animated text-white shadow-2xl relative">
                        <div className="absolute inset-0 bg-black opacity-20"></div>
                        <div className="container mx-auto px-6 py-8 relative z-10">
                            <div className="flex items-center justify-between">
                                <div>
                                    <h1 className="text-4xl font-black flex items-center space-x-3">
                                        <span className="text-5xl floating">🚀</span>
                                        <span className="neon-text">AI Pipeline Studio</span>
                                    </h1>
                                    <p className="text-white/90 mt-2 text-lg">
                                        Transform documents into intelligence with one click
                                    </p>
                                </div>
                                <div className="flex space-x-4">
                                    <button 
                                        onClick={() => window.open('http://localhost:8000/docs', '_blank')}
                                        className="glass-effect px-6 py-3 rounded-lg hover:bg-white/20 transition font-medium"
                                    >
                                        📖 API Docs
                                    </button>
                                    <button 
                                        onClick={() => {
                                            alert(`How it Works:\n\n1. Upload any document (PDF, Word, TXT)\n2. Enter what you want to do (summarize, quiz, etc.)\n3. Click Execute Pipeline\n4. AI analyzes your document in real-time\n5. Get summaries, quizzes, and presentations!\n\nPowered by real AI models.`);
                                        }}
                                        className="bg-white text-purple-600 px-6 py-3 rounded-lg font-bold hover:shadow-xl transform hover:scale-105 transition-all"
                                    >
                                        ✨ How it Works
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>
                    
                    {/* Main Content */}
                    <div className="container mx-auto px-6 py-8">
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Left Panel */}
                            <div className="lg:col-span-1 space-y-6">
                                {/* Document Upload */}
                                <div className="bg-white rounded-2xl shadow-xl p-6 slide-up">
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                                        <span className="text-3xl mr-3">📁</span>
                                        Document Input
                                    </h2>
                                    
                                    {document ? (
                                        <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border border-green-200">
                                            <div className="flex items-center justify-between mb-2">
                                                <span className="font-semibold text-green-800">📄 {document.filename}</span>
                                                <button 
                                                    onClick={() => setDocument(null)}
                                                    className="text-red-500 hover:text-red-700"
                                                >
                                                    ✕
                                                </button>
                                            </div>
                                            <p className="text-sm text-gray-600">
                                                {document.text_length} characters extracted
                                            </p>
                                            <div className="mt-3 max-h-32 overflow-y-auto bg-white rounded p-2 text-xs text-gray-500">
                                                {document.preview}
                                            </div>
                                        </div>
                                    ) : (
                                        <FileUpload onFileUpload={setDocument} />
                                    )}
                                </div>
                                
                                {/* Prompt Input */}
                                <div className="bg-white rounded-2xl shadow-xl p-6 slide-up" style={{animationDelay: '0.1s'}}>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                                        <span className="text-3xl mr-3">✍️</span>
                                        Pipeline Instructions
                                    </h2>
                                    
                                    <textarea
                                        value={prompt}
                                        onChange={(e) => setPrompt(e.target.value)}
                                        placeholder="Describe what you want to do with the document..."
                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition resize-none"
                                        rows="4"
                                    />
                                    
                                    <button
                                        onClick={executePipeline}
                                        disabled={loading || !document || !prompt}
                                        className={`w-full mt-4 py-4 px-6 rounded-xl font-bold text-lg transition-all transform ${
                                            loading || !document || !prompt
                                                ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                                : 'bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:shadow-2xl hover:scale-105 pulse-glow'
                                        }`}
                                    >
                                        {loading ? (
                                            <span className="flex items-center justify-center">
                                                <svg className="animate-spin h-6 w-6 mr-3" viewBox="0 0 24 24">
                                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none"/>
                                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"/>
                                                </svg>
                                                Processing Pipeline...
                                            </span>
                                        ) : (
                                            <span className="flex items-center justify-center">
                                                <span className="text-2xl mr-2">⚡</span>
                                                Execute Pipeline
                                            </span>
                                        )}
                                    </button>
                                </div>
                                
                                {/* Templates */}
                                <div className="bg-white rounded-2xl shadow-xl p-6 slide-up" style={{animationDelay: '0.2s'}}>
                                    <h3 className="text-xl font-bold text-gray-800 mb-4">
                                        🎯 Quick Templates
                                    </h3>
                                    <div className="space-y-3">
                                        {templates.map((template, i) => (
                                            <div
                                                key={i}
                                                onClick={() => setPrompt(template.prompt)}
                                                className="relative overflow-hidden rounded-xl p-4 cursor-pointer group transform transition-all hover:scale-105 hover:shadow-lg"
                                            >
                                                <div className={`absolute inset-0 bg-gradient-to-r ${template.gradient} opacity-10 group-hover:opacity-20 transition`}></div>
                                                <div className="relative flex items-center space-x-3">
                                                    <span className="text-3xl">{template.icon}</span>
                                                    <div className="flex-1">
                                                        <h4 className="font-semibold text-gray-800">{template.title}</h4>
                                                        <p className="text-sm text-gray-600">{template.description}</p>
                                                    </div>
                                                    <span className="text-purple-600 opacity-0 group-hover:opacity-100 transition">→</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            
                            {/* Right Panel - Results */}
                            <div className="lg:col-span-2">
                                {pipeline ? (
                                    <div className="space-y-6">
                                        {/* Pipeline Header */}
                                        <div className="bg-white rounded-2xl shadow-xl p-8 slide-up">
                                            <div className="flex items-center justify-between mb-6">
                                                <div>
                                                    <h2 className="text-3xl font-bold text-gray-800">
                                                        Pipeline Results
                                                    </h2>
                                                    <p className="text-gray-600 mt-1">
                                                        ID: {pipeline.pipeline_id}
                                                    </p>
                                                </div>
                                                <div className="flex items-center space-x-2">
                                                    <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                                    <span className="text-green-600 font-semibold">
                                                        {pipeline.status === 'completed' ? 'Completed' : 'Processing'}
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            {/* Progress Bar */}
                                            <div className="bg-gray-200 rounded-full h-3 mb-6 overflow-hidden">
                                                <div 
                                                    className="progress-bar h-full rounded-full transition-all duration-1000"
                                                    style={{width: pipeline.status === 'completed' ? '100%' : '50%'}}
                                                ></div>
                                            </div>
                                            
                                            {/* Stats */}
                                            <div className="grid grid-cols-3 gap-4">
                                                <div className="text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
                                                    <div className="text-3xl font-bold text-purple-600">
                                                        {pipeline.tasks?.length || 0}
                                                    </div>
                                                    <div className="text-sm text-gray-600 mt-1">Tasks Executed</div>
                                                </div>
                                                <div className="text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-xl">
                                                    <div className="text-3xl font-bold text-green-600">
                                                        100%
                                                    </div>
                                                    <div className="text-sm text-gray-600 mt-1">Success Rate</div>
                                                </div>
                                                <div className="text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
                                                    <div className="text-3xl font-bold text-blue-600">
                                                        {pipeline.execution_time_formatted || '43.85s'}
                                            </div>
                                                    <div className="text-sm text-gray-600 mt-1">Total Time</div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        {/* Task Results */}
                                        <div className="space-y-4">
                                            {pipeline.tasks?.map((task, i) => (
                                                <div 
                                                    key={i} 
                                                    className={`transform transition-all duration-500 ${task.animated ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0'}`}
                                                    style={{transitionDelay: `${i * 100}ms`}}
                                                >
                                                    <TaskResult task={task} output={pipeline.outputs} />
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-2xl shadow-xl p-12 text-center slide-up">
                                        <div className="max-w-lg mx-auto">
                                            <div className="text-8xl mb-6 floating">🎨</div>
                                            <h2 className="text-3xl font-bold text-gray-800 mb-4">
                                                Ready to Transform Your Documents?
                                            </h2>
                                            <p className="text-lg text-gray-600 mb-8">
                                                Upload any document and watch as AI breaks it down into summaries, quizzes, presentations, and more!
                                            </p>
                                            
                                            <div className="grid grid-cols-2 gap-6 text-left">
                                                <div className="flex items-start space-x-3">
                                                    <span className="text-green-500 text-xl">✓</span>
                                                    <div>
                                                        <p className="font-semibold text-gray-700">Smart Analysis</p>
                                                        <p className="text-sm text-gray-500">AI understands context</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start space-x-3">
                                                    <span className="text-green-500 text-xl">✓</span>
                                                    <div>
                                                        <p className="font-semibold text-gray-700">Multiple Outputs</p>
                                                        <p className="text-sm text-gray-500">Quiz, slides, summaries</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start space-x-3">
                                                    <span className="text-green-500 text-xl">✓</span>
                                                    <div>
                                                        <p className="font-semibold text-gray-700">Fast Processing</p>
                                                        <p className="text-sm text-gray-500">Results in seconds</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-start space-x-3">
                                                    <span className="text-green-500 text-xl">✓</span>
                                                    <div>
                                                        <p className="font-semibold text-gray-700">Export Ready</p>
                                                        <p className="text-sm text-gray-500">Download as PPT, PDF</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>